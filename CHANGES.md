# تغییرات اخیر - نمودار قوسی خورشید و ماه 🌅🌙

## تغییرات اصلی

### 1. تبدیل نمودار مسطح به قوس (Arc Diagram) ✨
- **قبل**: نمودار یک خط مستقیم افقی بود
- **بعد**: نمودار به صورت قوس (Quadratic Bezier Curve) است که مسیر واقعی خورشید و ماه در آسمان را نشان می‌دهد

### 2. نقاط زمانی روی نمودار خورشید ⏰
افزودن نقاط زمانی ثابت روی قوس:
- ۹ صبح
- ۱۲ ظهر
- ۳ بعدازظهر
- ۶ عصر

### 3. جلوه‌های بصری پیشرفته 🎨
- **Gradient رنگی**: استفاده از gradient برای نمایش تغییر رنگ از طلوع به غروب
- **Glow Effect**: افکت درخشش (glow) برای خورشید و ماه
- **پس‌زمینه آسمان**: افزودن پس‌زمینه آبی روشن برای خورشید و آبی تیره برای ماه
- **ستاره‌های چشمک‌زن**: ستاره‌های متحرک با انیمیشن روی نمودار ماه

### 4. انیمیشن‌های زنده 🌟
- **Pulse Animation**: خورشید و ماه با انیمیشن pulse نمایش داده می‌شوند
- **Smooth Transition**: حرکت نرم و روان خورشید/ماه روی قوس با cubic-bezier
- **Opacity Control**: خورشید/ماه هنگام غروب شفاف می‌شوند

### 5. محاسبات دقیق موقعیت 📐
- استفاده از فرمول Quadratic Bezier Curve برای محاسبه موقعیت دقیق
- فرمول: 
  - `x = (1-t)² × x₀ + 2(1-t)t × xc + t² × x₁`
  - `y = (1-t)² × y₀ + 2(1-t)t × yc + t² × y₁`
- جایی که t = درصد زمان از طلوع تا غروب (0 تا 1)

### 6. رفع مشکل موقعیت خورشید 🔧
- بهبود debug logs برای بررسی دقیق‌تر زمان‌ها
- نمایش واضح‌تر وضعیت خورشید (قبل از طلوع، در حال طلوع، بعد از غروب)

## فایل‌های تغییر یافته

### `index.html`
- افزودن SVG با gradient و filter برای خورشید و ماه
- افزودن نقاط زمانی و برچسب‌ها
- افزودن ستاره‌های متحرک برای نمودار ماه

### `app.js`
- پیاده‌سازی محاسبه موقعیت روی قوس Bezier
- حذف استفاده از المنت‌های قدیمی (`sunPosition`, `moonPosition`)
- بهبود debug logs
- افزودن کنترل opacity برای نمایش/مخفی کردن

### `styles.css`
- افزودن استایل برای `.arc-track`
- افزودن انیمیشن `sunPulse` و `moonPulse`
- بهبود transition ها

## نحوه کار نمودار

1. **دریافت داده**: زمان طلوع و غروب از API دریافت می‌شود
2. **محاسبه درصد**: درصد زمان سپری شده از طلوع تا غروب محاسبه می‌شود
3. **تبدیل به موقعیت**: درصد به موقعیت (x, y) روی قوس تبدیل می‌شود
4. **نمایش**: خورشید/ماه در موقعیت محاسبه شده نمایش داده می‌شود

## مثال محاسبه

اگر:
- طلوع: 06:18
- غروب: 17:18
- ساعت فعلی: 15:18

آنگاه:
- زمان سپری شده: 15:18 - 06:18 = 9 ساعت
- طول روز: 17:18 - 06:18 = 11 ساعت
- درصد: 9/11 = 81.8%
- موقعیت: نزدیک به غروب (سمت راست نمودار)

## توجه

اگر موقعیت خورشید هنوز نادرست است، لطفاً:
1. کنسول مرورگر را باز کنید (F12)
2. به debug logs نگاه کنید
3. بررسی کنید که timezone درست تشخیص داده شده است
4. اطمینان حاصل کنید که زمان سیستم شما درست است

