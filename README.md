# 🌦️ هواشناسی خفن

یک وب‌اپلیکیشن هواشناسی پیشرفته با قابلیت‌های نجومی و نمایش دقیق موقعیت خورشید و ماه

## ✨ امکانات

### 🌍 موقعیت‌یابی
- تشخیص خودکار موقعیت با GPS
- Fallback به IP location
- جستجوی شهر با autocomplete
- ذخیره تا ۲۰ شهر و سویچ بین آنها

### 🌤️ هواشناسی
- وضعیت فعلی با جزئیات کامل
- پیش‌بینی ساعتی (۲۴ ساعت)
- پیش‌بینی روزانه (۷ یا ۱۴ روز)
- انیمیشن‌های زیبا برای آفتابی، ابری، بارانی، برفی
- تم‌های دینامیک بر اساس وضعیت هوا

### 📊 آمار تاریخی
- بارش هفته/ماه/۶ماه/سال گذشته
- نمودارهای تعاملی با Chart.js
- آمار دما و بارش

### ☀️🌙 نجوم
- **نمودار قوسی خورشید** (جدید! 🎨): 
  - نمایش مسیر واقعی خورشید در آسمان به صورت قوس زیبا
  - نقاط زمانی (۹ صبح، ۱۲ ظهر، ۳ بعدازظهر، ۶ عصر)
  - Gradient رنگی از طلوع تا غروب
  - افکت درخشش (glow) و انیمیشن pulse
  - محاسبه دقیق موقعیت با Quadratic Bezier Curve
- **نمودار قوسی ماه** (جدید! 🌙):
  - قوس زیبا برای مسیر ماه
  - ستاره‌های چشمک‌زن متحرک
  - افکت‌های بصری شب
- **فاز ماه واقعی**: نمایش گرافیکی ۸ فاز ماه با دهانه‌ها و دریاها
- **منظومه شمسی با موقعیت‌های واقعی نجومی**:
  - ۸ سیاره (عطارد، زهره، زمین، مریخ، مشتری، زحل، اورانوس، نپتون)
  - محاسبات دقیق بر اساا الگوریتم‌های VSOP87 و Keplerian
  - موقعیت سیارات برای **هر تاریخ** و **هر ساعت**
  - کنترل اسلایدر برای تغییر ساعت و مشاهده حرکت سیارات
  - نمایش فاصله، مختصات، و زاویه هر سیاره
  - به‌روزرسانی لحظه‌ای با تغییر روز یا ساعت
  - حلقه زحل + ماه زمین
- طلوع/غروب خورشید و ماه
- طول روز و شب
- شاخص UV

### 🎯 ناوبری بین روزها
- کلیک روی هر روز → تمام صفحه تغییر می‌کند
- نمایش ساعت به ساعت آن روز
- دکمه‌های قبل/بعد برای سویچ سریع

### 📱 ریسپانسیو
- کاملاً واکنش‌گرا
- بهینه برای موبایل، تبلت، دسکتاپ

## 🚀 نحوه استفاده

1. فایل `index.html` را در مرورگر باز کنید
2. اجازه دسترسی به موقعیت را بدهید (اختیاری)
3. یا شهر مورد نظر را جستجو کنید

## 🐛 دیباگ موقعیت خورشید/ماه

اگر موقعیت خورشید دقیق نیست:

1. **کنسول مرورگر را باز کنید**: `F12` یا `Ctrl+Shift+I`
2. به تب **Console** بروید
3. خروجی‌های زیر را ببینید:

```
🌅 Debug Sun Position:
Current Time (Local): ...
Sunrise: ...
Sunset: ...
☀️ Sun is UP!
Position %: ...
```

### چک کنید:
- آیا `Current Time` با ساعت واقعی شما مطابقت دارد؟
- آیا `Sunrise` و `Sunset` درست هستند؟
- آیا `Position %` منطقی است؟

### محاسبه دستی:
```
موقعیت٪ = ((زمان فعلی - طلوع) / (غروب - طلوع)) × ۱۰۰
```

مثال:
- طلوع: ۰۶:۳۲ (۶.۵۳ ساعت)
- غروب: ۱۷:۱۸ (۱۷.۳ ساعت)
- الان: ۱۲:۰۰ (۱۲ ساعت)

```
موقعیت = ((۱۲ - ۶.۵۳) / (۱۷.۳ - ۶.۵۳)) × ۱۰۰
        = (۵.۴۷ / ۱۰.۷۷) × ۱۰۰
        = ۵۰.۸٪
```

## 🌐 منابع داده و الگوریتم‌ها

### API های استفاده شده:
- **هواشناسی**: [Open-Meteo](https://open-meteo.com) - دقیق‌ترین API رایگان
- **کیفیت هوا**: Open-Meteo Air Quality API
- **آرشیو تاریخی**: Open-Meteo Archive API
- **Geocoding**: Open-Meteo Geocoding API

### الگوریتم‌های نجومی:
- **VSOP87**: برای محاسبه عناصر مداری سیارات
- **Kepler's Equation**: برای محاسبه موقعیت دقیق سیارات
- **Julian Day**: برای تبدیل تاریخ و زمان
- مرجع: [JPL Horizons](https://ssd.jpl.nasa.gov/horizons/) و [Astronomical Algorithms by Jean Meeus](https://www.willbell.com/math/MC1.HTM)

## 🎨 فناوری‌ها

- HTML5
- CSS3 (Grid, Flexbox, Animations)
- Vanilla JavaScript (ES6+)
- Chart.js برای نمودارها
- فونت Vazirmatn

## 📝 یادداشت‌های فنی

### محاسبه موقعیت خورشید/ماه روی قوس (جدید! 🎨)

نمودار خورشید و ماه از **Quadratic Bezier Curve** برای نمایش مسیر واقعی در آسمان استفاده می‌کند:

#### فرمول محاسبه:
```
قوس: M 20,130 Q 200,20 380,130
- نقطه شروع (طلوع): (20, 130)
- نقطه کنترل (اوج): (200, 20)
- نقطه پایان (غروب): (380, 130)
```

#### محاسبه موقعیت (x, y):
```javascript
t = (زمان فعلی - طلوع) / (غروب - طلوع)  // 0 تا 1
x = (1-t)² × 20 + 2(1-t)t × 200 + t² × 380
y = (1-t)² × 130 + 2(1-t)t × 20 + t² × 130
```

#### مثال:
- طلوع: 06:18
- غروب: 17:18  
- ساعت فعلی: 15:18
- t = (15:18 - 06:18) / (17:18 - 06:18) = 9/11 = 0.818
- موقعیت: نزدیک به انتهای قوس (غروب)

### محاسبه موقعیت سیارات (جدید! 🚀)

این برنامه از **الگوریتم‌های نجومی دقیق** برای محاسبه موقعیت واقعی سیارات استفاده می‌کند:

#### 1. **Julian Day Number (JD)**
- تبدیل تاریخ و ساعت به شماره روز جولیان
- دقت تا سطح ثانیه
- مرجع: J2000.0 (1 ژانویه 2000، ساعت 12:00 UTC)

#### 2. **عناصر مداری سیارات (Orbital Elements)**
برای هر سیاره، پارامترهای زیر محاسبه می‌شود:
- `a` (Semi-major axis): نیم‌قطر بزرگ مدار به AU
- `e` (Eccentricity): کجی مدار
- `I` (Inclination): زاویه انحراف نسبت به صفحه اکلیپتیک
- `L` (Mean longitude): طول میانگین
- `ω̃` (Longitude of perihelion): طول نزدیک‌ترین نقطه به خورشید
- `Ω` (Longitude of ascending node): طول گره صعودی

این مقادیر بر اساس **VSOP87** (Variations Séculaires des Orbites Planétaires) محاسبه شده و با گذر زمان به‌روزرسانی می‌شوند.

#### 3. **حل معادله کپلر (Kepler's Equation)**
```
M = E - e·sin(E)
```
- `M`: Anomaly میانگین
- `E`: Eccentric Anomaly (با روش تکراری Newton-Raphson حل می‌شود)
- `e`: Eccentricity

#### 4. **محاسبه True Anomaly**
```
v = 2·atan2(√(1+e)·sin(E/2), √(1-e)·cos(E/2))
```

#### 5. **تبدیل به مختصات هلیوسنتریک**
موقعیت هر سیاره در سیستم مختصات 3D (X, Y, Z) نسبت به خورشید محاسبه می‌شود.

#### دقت محاسبات:
- ✅ دقیق برای بازه زمانی 1800-2200 میلادی
- ✅ خطای کمتر از 1 درجه برای موقعیت سیارات
- ✅ به‌روزرسانی لحظه‌ای با تغییر ساعت
- ✅ در نظر گرفتن timezone محلی

### محاسبه فاز ماه
از فرمول Julian Day استفاده شده که دقت بالایی دارد. محاسبه Moon Age (عمر ماه از آخرین ماه نو) با دقت ده‌دهم روز.

### طلوع/غروب ماه
از تقریب ساده بر اساس فاز ماه استفاده شده. برای دقت بیشتر می‌توان از کتابخانه‌های نجومی استفاده کرد.

### Timezone
همه محاسبات بر اساس timezone شهر انتخابی انجام می‌شود.

### کنترل زمان در منظومه شمسی
- **امروز**: موقعیت سیارات برای ساعت فعلی محاسبه می‌شود (به‌روزرسانی با دکمه "اکنون")
- **روزهای دیگر**: پیش‌فرض ساعت 12 ظهر
- **اسلایدر ساعت**: امکان تغییر ساعت از 00:00 تا 23:00 و مشاهده تغییرات موقعیت سیارات

## 🔧 عیب‌یابی رایج

### خورشید در موقعیت اشتباه
- مرورگر را Refresh کنید
- کنسول را چک کنید
- مطمئن شوید timezone دستگاه شما درست است

### ماه نمایش داده نمی‌شود
- چند روز جلو/عقب بروید تا فاز تغییر کند
- Refresh کنید

### داده‌ها نمایش داده نمی‌شوند
- اتصال اینترنت را چک کنید
- کنسول را برای خطاها بررسی کنید

## 📄 لایسنس

این پروژه تحت لایسنس MIT منتشر شده است.

## 🤝 مشارکت

برای گزارش مشکلات یا پیشنهادات بهبود، لطفاً Issue ایجاد کنید.

---

ساخته شده با ❤️ و ☕

## 🌐 زبان

- [فارسی (Persian)](README.md)
- [English](README.en.md)

